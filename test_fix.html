<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Тест исправления LaTeX</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
    <h1>Тест обработки LaTeX формул с двойными бэкслешами</h1>
    <div id="content">
        <!-- Содержимое, которое будет имитировать ответ от сервера -->
        <p>Цена природного газа в отношении объекта генерации определяется по следующей формуле:</p>
        <p>\\[ P_{газ,X} = P_{мин,X-1}, \\]</p>
        <p>где \\( P_{мин,X-1} \\) — действующий в году \\( X-1 \\) предельный минимальный уровень оптовых цен на природный газ</p>
    </div>

    <script>
        // Копия функции replaceLatex из обновленного index.html
        function replaceLatex(text) {
            // Заменяем экранированные блочные формулы \\[ ... \\] на MathJax блочные теги
            text = text.replace(/\\\[(.*?)\\\]/g, '\\\\[$1\\\\]');
            // Заменяем экранированные inline формулы \\( ... \\) на MathJax inline теги
            text = text.replace(/\\\((.*?)\\\)/g, '\\\\($1\\\\)');
            // Также поддерживаем старые форматы $...$ и $$...$$
            text = text.replace(/\\$\\$(.*?)\\$\\$/g, '\\\\[$1\\\\]');
            text = text.replace(/\\$(.*?)\\$/g, '\\\\($1\\\\)');
            return text;
        }

        // Применяем обработку к содержимому
        const contentDiv = document.getElementById('content');
        const originalText = contentDiv.innerHTML;
        console.log("Оригинальный текст:", originalText);
        const processedText = replaceLatex(originalText);
        console.log("Обработанный текст:", processedText);
        contentDiv.innerHTML = processedText;

        // Обновляем MathJax после вставки контента
        if (typeof MathJax !== 'undefined') {
            MathJax.typesetPromise([contentDiv]);
        }
    </script>
</body>
</html>